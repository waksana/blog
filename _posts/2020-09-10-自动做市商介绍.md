最近区块链上DeFi很火，我就去了解一下，和以前玩法有什么不一样。看下来发现除了以前就有的借贷和交易所，还有四个比较有趣的东西是以前没有的。

1. 自动做市商（Uniswap）
2. 智能合约理财 （yearn)
3. 闪电贷 (Aave)
4. 有抵押稳定币 (MakerDao)

自动做市商和闪电贷这两个技术让我惊叹。今天先介绍一下自动做市商的机制。

传统的交易所会维护一个订单簿，记录了所有买的价格和卖的价格。交易所会撮合同一价格的买卖双方成交。我之前在eos上写过一个这样的交易所。但是撮合的逻辑非常重，经常在撮合大单的时候跑完cpu。本来打算写第二个版本，把撮合交给别人来做，并且支付手续费作为奖励（如果做成了现在就是撮合挖矿了。。。）。结果eos价格一落千丈我也没有信心继续完成这个版本。

而自动做市商没有订单簿，取而代之的是一个包含交易对双方币种的资金池，这两个币种的总价值是1：1。比如总价值1000美元的ETH-DAI交易对的资金池中有1个ETH和500个DAI（DAI是一种等价美元的稳定币，1 usd = 1 dai）。这时候就可以得出一个ETH的价格就是500美元。任何时候我们都可以向资金池中1：1放入两种代币，而我们就会一定比例的占有这个资金池，合约会给我们LP token作为拥有部分资金池的证明。当交易发生的时候，合约会收取一定的手续费，存入资金池。资金池的价值就会升高，我们拥有的价值也会升高。

当我想要进行交易的时候合约又是如何判断价格的呢？Uniswap用了一种开创式的算法：设我们有X个ETH，Y个DAI。合约保证X * Y在交易前后不变。也就是当我们需要用a个DAI购买ETH的时候，合约会给我们b个ETH使得

```
X * Y = (X - b) * (Y + a)
```
