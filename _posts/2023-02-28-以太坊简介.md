说到以太坊，大家一定会联想到一些关键词：区块链，智能合约，加密货币。对我来说，我可以从某些侧面来理解以太坊，比如以太坊是一条区块链；以太坊能运行智能合约；以太坊是一种加密货币。下面我将把这些结合在一起，一探以太坊的全貌。

### 区块链

首先，以太坊是一条区块链。区块链是一种数据结构，类似于链表。每一个区块都有一个指向前一个区块的指针。区块链在链表的基础上做了一个改动，仅仅一个小的改动就让这个数据结构爆发出了改变世界的力量。链表里指针的内容是前一项的内存地址，在区块链中，指针的内容改为前一个区块的哈希。这就让区块链具备了防篡改的能力，从而可以去中心化的存储和验证。

现在我们大致了解了区块链，他的主要功能是去中心化的存储不可篡改的数据。由于需要在每个全节点都存储全量的数据，并且在节点中同步。这个存储是非常昂贵的。并且由区块链的结构我们可以看出，存入区块的数据是无法更改的。这使得区块链适用于存储一些不会更改的关键数据。账本完美的契合这一场景。所以比特币诞生了。如果区块中存储的是一笔笔转账信息，这些转账信息用特定的方式总结起来，形成一个哈希值。我们就得到了比特币的区块链。

那功能更为丰富的以太坊的区块链中存储的是什么内容呢？如何在区块链存储的基础上实现智能合约呢？我们得先了解什么是智能合约，他需要怎么样的存储结构。

### 智能合约

我们可以把以太坊想象成一台全球唯一的电脑，所有的用户都在使用。电脑里存着所有用户的信息。智能合约就是里面安装的程序。用户调用程序之后，电脑会执行这个程序并且更改电脑里一些用户的信息，或者调用另一个程序。区块链负责这台电脑的存储，而矿工则负责程序的运行。为了实现智能合约我们需要区块链能够存储每个用户的信息和智能合约的内容。以太坊统一了用户和智能合约，把他们都看成是账号。用户的账号里存着他的余额和用户状态；智能合约的账号里存着代码和智能合约的一些状态。

```mermaid
flowchart LR
    A(State) --> |Transaction| B(State')
```

我们使用以太坊的时候很重要的概念就是钱包地址。这个地址就是每一个账号的唯一索引。每个智能合约也都有一个类似的地址。为了在区块链上实现地址到状态的存储和更改，以太坊使用了一种数据结构，叫默克尔路径压缩的字典树(MPT)。听起来非常复杂，但这里又涉及到了一个小改动：在普通路径压缩字典树的指针上加入了对子节点的哈希。随着了解的深入我们未来经常能发现，区块链中许多精妙的数据结构常常是把普通数据结构的指针换成了哈希指针。

（此处MPT示例插图）

MPT让状态容易的检索和更改，也方便了状态的哈希。这样我们只需把所有状态的哈希存在区块链中。而巨大的状态内容可以使用别的存储方式，并且用链上的哈希去验证。为了方便使用，以太坊在链上存储了交易树和收据树，收据树是执行智能合约的结果。这些树都是以MPT的形式来存储。

到这里以太坊的大致结构已经逐渐清晰，之后会持续对一些有趣的特性做详细的介绍。